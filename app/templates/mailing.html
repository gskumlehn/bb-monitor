{% extends "base.html" %}

{% block title %}Gerenciamento de Mailing de alertas{% endblock %}

{% block header_title %}Gerenciamento de Mailing de alertas{% endblock %}

{% block content %}
    <div class="content-wrapper">
        <div class="card small-card form-card">
            <div class="card-header">
                <h2>Adicionar Novo E-mail</h2>
            </div>
            <div class="card-content">
                <form id="saveForm" class="form">
                    <div class="form-group">
                        <label for="email" class="label">
                            E-mail
                        </label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            class="input"
                        >
                    </div>

                    <div class="form-group">
                        <label for="directorate_code" class="label">
                            Diretoria
                        </label>
                        <select
                            id="directorate_code"
                            name="directorate_code"
                            required
                            class="input"
                        >
                            {% for code, label in directorate_codes.items() %}
                                <option value="{{ code }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Adicionar
                    </button>
                </form>
            </div>
        </div>

        <div class="card form-card">
            <div class="card-header card-header-tabs">
                <div class="card-header-tab active" id="tabListEmails">
                    <h2>Listagem de E-mails</h2>
                </div>
                <div class="card-header-tab" id="tabListDirectorates">
                    <h2>Listagem de Diretorias</h2>
                </div>
            </div>
            <div class="card-content">
                <form id="filterForm" class="form">
                    <!-- Modo Listagem de E-mails: Filtro por Diretoria -->
                    <div class="form-group" id="filterByDirectorateGroup">
                        <label for="filter_directorate_code" class="label">
                            Diretoria
                        </label>
                        <select
                            id="filter_directorate_code"
                            class="input"
                        >
                            {% for code, label in directorate_codes.items() %}
                                <option value="{{ code }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Modo Listagem de Diretorias: Filtro por E-mail -->
                    <div class="form-group" id="filterByEmailGroup" style="display: none;">
                        <label for="filter_email" class="label">
                            E-mail
                        </label>
                        <input
                            type="email"
                            id="filter_email"
                            class="input"
                            placeholder="Digite o e-mail"
                        >
                    </div>

                    <button type="submit" id="filterBtn" class="btn btn-primary">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        Listar
                    </button>
                </form>

                <div id="listContainer" style="margin-top: 20px; display: none;">
                    <table id="resultsTable" class="table card-table">
                        <thead>
                            <tr>
                                <th id="resultHeaderMain">E-mail</th>
                                <th class="actions-cell">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be injected here -->
                        </tbody>
                    </table>
                    <p id="noResultsMessage" class="text-muted" style="text-align: center; padding: 20px; display: none;">Nenhum resultado encontrado.</p>
                    <p id="loadingMessage" class="text-muted" style="text-align: center; padding: 20px; display: none;">Carregando...</p>
                    <p id="errorMessage" class="text-danger" style="text-align: center; padding: 20px; display: none;">Erro ao carregar dados.</p>
                </div>
            </div>
        </div>
    </div>

    {% include "_delete_mailing_confirm_modal.html" %}
{% endblock %}

{% block scripts %}
    <script>
        const DIRECTORATE_LABELS = {{ directorate_codes | tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/mailing.js') }}"></script>
{% endblock %}
